var ribbonElem=null;var moreFiltersElem=null;var initRibbon=function(){function splitCamelCase(word){return word.replace(/([A-Z])/g," $1").replace(/^./,function(str){return str.toUpperCase()})}function getOption(word){var obj={};var rem=word.split(" ");obj.option=rem.pop();obj.title=rem.join(" ");return obj}function getFilterInfo(filterType){var whichFilter=$(filterType).data("title");whichFilter=$.trim(whichFilter);return filtersMap[whichFilter]}function optionsCount($thisSelect){return $thisSelect.find("option").length}var $filters=[],filtersMap={},activeFilters={};function findActiveFilters(lastFiltersObj){if(!$.isEmptyObject(lastFiltersObj)){this.init(lastFiltersObj)}else{console.warn("No ribbon cookie information found!")}}function processActiveFilters(filterObj){function getFilterTitle(){var filterTitles=[];$.each(filterObj,function(prop,val){var title=$.trim(splitCamelCase(prop));if(title.indexOf("Request Status")>-1){var info=getOption(title);title=info.title;if(title in filtersMap){var arr=filtersMap[title]["option"];arr.push(info.option);val=arr}else{arr=[];arr.push(info.option);val=arr;title=info.title}}if(filterTitles.length==0){filterTitles.push(title)}else{var titleExist=false;filterTitles.forEach(function(eTitle){if(eTitle==title){titleExist=true}});!titleExist&&filterTitles.push(title)}filtersMap[title]={option:val,original:prop}});return filterTitles}var filterTitles=getFilterTitle();$.each(filterTitles,function(indx,title){var elem=ribbonElem.find('[data-title = "'+title+'"]');if(elem){$filters.push(elem)}});function typeOfFilter(){$filters.forEach(function(filterType){var filterTypeElem=$(filterType),filterInfo=getFilterInfo(filterType);if(filterTypeElem.attr("multiple")){$(filterType).multipleSelect("setSelects",filterInfo.option)}else if(filterTypeElem.data("title")=="Request Status"){setSimpleNoSelectFilters($(filterType),filterInfo.option)}else if(filterTypeElem.parent("a").attr("data-dynamic")==="true"){setDynamicFilters($(filterType),filterInfo.option)}})}function setSimpleNoSelectFilters(multiSelct,options){$(multiSelct).find("li").each(function(){var $li=$(this);$li.removeClass("active-item-bg");options.forEach(function(option){if(!!$li.find('a[title="'+option+'"]').length){$li.addClass("active-item-bg")}})})}function setDynamicFilters(multiSelct,options){var $li=$(multiSelct).closest("li");var $select=$li.find("select");options.forEach(function(option){$select.append('<option value="'+option.value+'" data-name="'+option.name+'">'+option.name+"</option>")});var tagTxt=$li.find("span[data-title]").data("title");tagTxt=tagTxt+" ("+optionsCount($select)+")";$li.find("span[data-title]").text(tagTxt);$li.addClass("active-item-bg")}return{typeOfFilter:typeOfFilter}}function init(filterObj){activeFilters=processActiveFilters(filterObj);activeFilters.typeOfFilter()}return{init:init,findActiveFilters:findActiveFilters}}();var ribbonListener=function(){var ribbonReqObj={},isDoneLoading=false;function rebuildRibbonState($rbWrapper){var $filter=$($rbWrapper).find("[data-isFilter=true]");ribbonReqObj={};isDoneLoading=false;return filtersCollection($filter)}function handleMultiSelect($multiSelect,filterType){var hasActive=false,parentTag=$multiSelect.closest("li");if($multiSelect.data("title")!==null||$multiSelect.data("title")!==undefined){ribbonReqObj[$multiSelect.data("title")]=[]}else{console.error("Undefined filter title")}$multiSelect.next().find(".ms-drop li").each(function(){var $li=$(this),option={};option.isSelected=function(){if($li.hasClass("selected")){if($li.parents(".sub-nav").length==0){parentTag.addClass("active-item-bg")}hasActive=true;return true}else{return false}}();option.value=$li.find("input").attr("value");option.text=$li.find("label").text();option.type=filterType;ribbonReqObj[$multiSelect.data("title")].push(option)});if(!hasActive){parentTag.removeClass("active-item-bg")}}function handleDefaultSelect(defaultSelect,filterType){if(defaultSelect.data("title")!==null||defaultSelect.data("title")!==undefined){ribbonReqObj[defaultSelect.data("title")]=[]}else{alert("No Title issue: see ribbon.js")}defaultSelect.find("option").each(function(){var $option=$(this);var option={};option.text=$option.text();option.value=$option.attr("value");option.type=filterType;option.isSelected=function(){if($option.attr("selected")){return true}else{return false}}();ribbonReqObj[defaultSelect.data("title")].push(option)})}function handleValueFromModal(whichModal,filtertype){var $thisModal=$(whichModal);var option={};ribbonReqObj[$thisModal.data("title")]=[];option.value=$thisModal.find("div:first-child").attr("filterid");option.text=$thisModal.find("div:first-child").text();option.isSelected=typeof option.value!="undefined"&&option.value!="";option.type=filtertype;ribbonReqObj[$thisModal.data("title")].push(option)}function handleNoSelectFilters(noSelect,filterType){var $prntLi=noSelect.parents("li"),prTitle=$prntLi.data("title");if(prTitle!==null||prTitle!==undefined){if(prTitle in ribbonReqObj){}else{ribbonReqObj[prTitle]=[]}}else{console.error("undefined title!!!")}var option={};option.text=noSelect.find("a span:last-child").text();option.value="no value assigned";option.type=filterType;option.isSelected=noSelect.hasClass("active-item-bg")?true:false;if(ribbonReqObj[prTitle].length>0){var tempArr=ribbonReqObj[prTitle].filter(function(obj){if(obj.text===option.text){return false}else{return true}});tempArr.push(option);ribbonReqObj[prTitle]=tempArr}else{ribbonReqObj[prTitle].push(option)}}function handleDynamicSelect(fromPopup,filterType){var filterTitle=$(fromPopup).find("[data-title]").data("title"),$dynamicSelectElem=$(fromPopup).siblings(".dynamic-select");if(filterTitle!==null||filterTitle!==undefined){ribbonReqObj[filterTitle]=[]}if($dynamicSelectElem.length>0){$dynamicSelectElem.find("option").each(function(){var $option=$(this);var option={};option.text=$option.text();option.value=$option.attr("value");option.name=$option.data("name");option.type=filterType;option.isSelected=true;ribbonReqObj[filterTitle].push(option)})}}function viewsSectionLogic(){var $checkBoxes=$("#views").find(".ms-drop").find("input"),views={active:""};function bindViewChanges(){$("#views").on("change.views",$checkBoxes,function(e){e.preventDefault();var $selected=$(e.target);if($selected.is("select")){views.clicked=getView($selected);if(views.clicked===views.active){if($($selected).multipleSelect("getSelects")==0){selectOppositeView(getView($selected))}else{return}}else{if($($selected).multipleSelect("getSelects")==0){return}clearOppositeView(getView($selected))}}})}function selectOppositeView(title){var oppositeView=title=="My Work"?"All Teams":"My Work";var $selectBack=$("#views").find('select[data-title="'+oppositeView+'"]');$selectBack.data("trigger","dynamic");views.active=oppositeView;$("#views").off(".views");$selectBack.multipleSelect("checkAll");$selectBack.parent("li").addClass("active-item-bg");bindViewChanges()}function clearOppositeView(title){if(title==undefined){return}else{var oppositeView=title=="My Work"?"All Teams":"My Work";var $selectOff=$("#views").find('select[data-title="'+oppositeView+'"]');$selectOff.data("trigger","dynamic");views.active=title;$("#views").off(".views");$selectOff.multipleSelect("setSelects",[]);$selectOff.parent("li").removeClass("active-item-bg");bindViewChanges()}}function getView(target){var title=$(target).data("title");$(target).parent("li").addClass("active-item-bg");return title}bindViewChanges()}function isFilterSecMultSelect(test){var $multiselect=$("#filters-section").find('select[multiple="multiple"]'),isFilter=false;$multiselect.each(function(){var title=$(this).data("title");if(test===title){isFilter=true}});return isFilter}var initISfunc={};function getISfunction(funcPassed){initISfunc=function(){var passedFunc=funcPassed;function run(){if(typeof passedFunc!=="undefined"||typeof passedFunc!=="function"){passedFunc(getISobj(ribbonReqObj))}}return{passedFund:passedFunc,run:run}}()}function getISobj(uiObj){var ISribbonObj={},obj=uiObj==undefined?ribbonReqObj:uiObj;String.prototype.capitalize=function(){if(this.length>0){return this.charAt(0).toUpperCase()+this.slice(1)}};function ISobjBuilder(){this.addProperty=function(propertyName,values){ISribbonObj[propertyName]=values};this.fixedPropertyName=function(title,option){var fixedTitle="";if(typeof option!=="undefined"){title=title+" "+option}if(title.indexOf(" ")>0){var titleArr=title.split(" ");titleArr.forEach(function(word){if(typeof word=="string"){fixedTitle=fixedTitle+word.capitalize()}})}else{if(typeof title=="string"){fixedTitle=title.capitalize()}}return fixedTitle}}function buildObj(obj){var numValues=[],activeOptions=[],objValue=[];$.each(obj,function(title,valueObj){if(Array.isArray(valueObj)&&valueObj.length>-1){valueObj.forEach(function(option){if(option.isSelected===true){if(option.type=="array-list"){numValues.push(option.value)}else if(option.type=="boolean"){activeOptions.push(option.text)}else if(option.type==="userType"){optObj={value:option.value,name:option.name};objValue.push(optObj)}}});if(numValues.length>0){isDropDown(title,numValues);numValues=[];return true}else if(activeOptions.length>0){noDropDown(title,activeOptions);activeOptions=[];return true}else if(objValue.length>0){isdynamicFilter(title,objValue);objValue=[];return true}}})}function isDropDown(title,values){var buildObj=new ISobjBuilder;buildObj.addProperty(buildObj.fixedPropertyName(title),values)}function noDropDown(title,options){var buildObj=new ISobjBuilder;options.forEach(function(optionName){buildObj.addProperty(buildObj.fixedPropertyName(title,optionName),true)})}function isdynamicFilter(title,options){var buildObj=new ISobjBuilder;buildObj.addProperty(buildObj.fixedPropertyName(title),options)}if($.isEmptyObject(obj)){console.error("empty object -- see func isdynamicFilter");return false}else{buildObj(obj);var IsObj=JSON.stringify(ISribbonObj);return IsObj}}function filtersCollection($filter){$filter.each(function(){if($(this).attr("multiple")){handleMultiSelect($(this),"array-list")}else if($(this).attr("data-select")==="default"){handleDefaultSelect($(this),"array-list")}else if($(this).attr("data-dynamic")==="true"){handleDynamicSelect($(this),"userType")}else if($(this).attr("filter-type")==="from-modal"){handleValueFromModal($(this),"array-list")}else if($(this).find("select").length==0){handleNoSelectFilters($(this),"boolean")}});ribbonWidgets.filterCollectorModule();$.cookie("SQFilterSettings",ribbonListener.getISobj(),{expires:365,path:"/"});initISfunc.run();return ribbonReqObj}function filterListener($rbWrapper){var isTimerRunning=false,ifMultipleClicks="",isLoop=0;$("#agile-status").on("click","a",function(e){e.preventDefault();if(!$("#agile-status").hasClass("disabled")){toggleActiveItem($(this).parent("li"));rebuildRibbonState($rbWrapper)}});$("#dp-sprint-dd").find("option:first-child").text("All Sprints")}function passFilterStateObj(){return ribbonReqObj}function init(ISprocess){var $filter=ribbonElem.find("[data-isFilter=true]");getISfunction(ISprocess);filtersCollection($filter);filterListener(ribbonElem);viewsSectionLogic()}return{isDoneLoading:isDoneLoading,init:init,rebuildRibbonState:rebuildRibbonState,passFilterStateObj:passFilterStateObj,isFilterSecMultSelect:isFilterSecMultSelect,getISobj:getISobj}}();var ribbonWidgets=function(){function filterCollectorModule(){var filterObj=ribbonListener.passFilterStateObj(),filterCollectorElem=$(".filter-collector");filterCollectorElem.html("");function findActiveFilters(){var activeFilters={};$.each(filterObj,function(filter,options){if(Array.isArray(options)){options.forEach(function(option){if(option.isSelected==true){if(filter in activeFilters){activeFilters[filter].push(option)}else{activeFilters[filter]=[];activeFilters[filter].push(option)}}})}});return activeFilters}function buildTmpl(activeFilters){filterCollectorElem.append("<ul><li>Filters:</li></ul>");var filterHtml="",activeArr=[];$.each(activeFilters,function(filter,options){filterHtml=String()+"<ul>"+"<li>"+filter+'<a href="#"> X</a></li>';if(Array.isArray(options)){options.forEach(function(option){filterHtml=filterHtml+"<li><span>"+option.text+"</span></li>"})}filterHtml=filterHtml+"</ul>";activeArr.push(filterHtml)});var cleanFilters=activeArr.join(" ");filterCollectorElem.append(cleanFilters)}function setXTrigger(){function updateMultiSelect(filterType,option){var updatedValues=[];if(option===undefined){$(filterType).data("trigger","dynamic");$(filterType).multipleSelect("setSelects",[])}else{var optionValues=$(filterType).multipleSelect("getSelects"),optionTxt=$(filterType).multipleSelect("getSelects","text");optionTxt.forEach(function(optionTxt,index){if(option==optionTxt){updatedValues=optionValues.splice(index,1)}});$(filterType).data("trigger","dynamic");$(filterType).multipleSelect("setSelects",optionValues)}}function updateDefaultSelect(filterType){$("#dp-sprint-dd").val("")}function updateDynamicSelect(filterType,option){var $filterWrap=$(filterType).parent("a");if(option===undefined){$filterWrap.siblings("select").html("");$(filterType).text($(filterType).data("title"))}else{$filterWrap.siblings("select option").each(function(){if($(this).text()==option){$(this).remove();editCountToLabel(filterType)}})}}function updateOptionFromModal(filterType){var $thisModal=$(filterType);$thisModal.find("div:first-child").attr("filterid","");$thisModal.find("div:first-child").html("<span>"+$thisModal.data("title")+"</span>")}function updateNoSelectFilters(filterType,option){if(option==undefined){$(filterType).find("li").each(function(){$(this).hasClass("active-item-bg")?$(this).removeClass("active-item-bg"):false})}else{$(filterType).find("li").each(function(){if($(this).find("a span:last-child").text()==option){$(this).removeClass("active-item-bg")}})}}function findFilterTitle(clickedElm){var filterUl=$(clickedElm).closest("ul"),filterTxt=filterUl.find("li").eq(0).text(),filterTile=cleanFilterTxt(filterTxt);return filterTile}function findOptionTxt(clickedElm){return $(clickedElm).siblings("span").text()}function cleanFilterTxt(filter){var filterTypeArr=filter.split(" ");filterTypeArr.pop();filter=filterTypeArr.join(" ");return filter}function removeLabelParenthesis(label){var tagTxtArr=label.split(" ");tagTxtArr.pop();label=tagTxtArr.toString();return label}function editCountToLabel(filterType){var tagTxt=filterType.text(),optionCount=$(filterType).siblings("select").find("option").length;if(tagTxt.indexOf("(")>-1){tagTxt=removeLabelParenthesis(tagTxt);if(optionCount!==0){tagTxt=tagTxt+" ("+optionCount+")";$(filterType).text(tagTxt)}else{$(filterType).text(tagTxt)}}else{tagTxt=tagTxt+" ("+optionCount+")";$(filterType).text(tagTxt)}}function whichFilterType(filterType,option){if($(filterType).attr("multiple")){updateMultiSelect($(filterType),option)}else if($(filterType).attr("data-select")==="default"){updateDefaultSelect($(filterType))}else if($(filterType).parent("a").attr("data-dynamic")==="true"){updateDynamicSelect($(filterType),option)}else if($(filterType).attr("filter-type")==="from-modal"){updateOptionFromModal($(filterType))}else if($(filterType).find("select").length==0){updateNoSelectFilters($(filterType),option)}}if(!filterCollectorElem.data("initialize")){filterCollectorElem.data("initialize",true);filterCollectorElem.on("click","a",function(e){e.preventDefault();var filterType=findFilterTitle($(this)),$dataTitle=ribbonElem.find('[data-title="'+filterType+'"]');if($(this).siblings("span").length>0){var optionTxt=findOptionTxt($(this));whichFilterType($dataTitle,optionTxt)}else{whichFilterType($dataTitle)}ribbonListener.rebuildRibbonState(ribbonElem)})}}buildTmpl(findActiveFilters());setXTrigger()}var moreFiltersPopover=function(){function onModalInputchange($modalName){var changeIcon=function(){$("#filter-"+$modalName).find("#"+$modalName+"-btn").addClass("hidden").end().find("> span").removeClass("hidden")},callRibbonListener=function(){ribbonListener.rebuildRibbonState(".sq-top-ribbon")};$.when(changeIcon()).done(callRibbonListener())}function init(){$(".sub-nav").on("click",".clear-btn",function(){var thisParent=$(this).parent("div");$(this).siblings("div").attr("filterid","").html("<span>"+thisParent.data("title")+"</span>").end().addClass("hidden").siblings("input[type=button]").removeClass("hidden");ribbonListener.rebuildRibbonState(".sq-top-ribbon")})}return{init:init,onModalInputchange:onModalInputchange}}();return{filterCollectorModule:filterCollectorModule,moreFiltersPopover:moreFiltersPopover}}();$(function(){ribbonElem=$(".sq-top-ribbon");moreFiltersElem=$("#sq-filters");var ribbonItem=ribbonElem.find("> ul > li > ul > li"),filterSubNavWrapper=moreFiltersElem.find(".sub-nav-wrapper"),filterSubNav=filterSubNavWrapper.find(".sub-nav");$("body").on("click",function(e){moreFiltersElem.removeClass("add-bg");$(".sub-nav").hide();if($(e.target).parent().find(".toggle-popover").length>0){$(".toggle-popover").popover("hide")}});moreFiltersElem.on("click",".ms-drop input, .ms-drop label",function(e){e.stopPropagation()}).on("click",function(e){e.stopPropagation();e.preventDefault();if(!$(this).parents(".disabled").length){if($(e.target).parents(".sub-nav-wrapper").length){return false}filterSubNav.toggle();$(this).toggleClass("add-bg");$(this).find(".sub-nav-wrapper").css("marginLeft","");if($("#sq-filters-item").hasClass("active-item-bg")){$(this).removeClass("add-bg").find(".sub-nav-wrapper").css("marginLeft","-6px")}if(filterSubNav.is(":visible")){filterSubNavWrapper.css("height","445px")}else{filterSubNavWrapper.css("height","0")}}});ribbonElem.find("select").each(function(){if($(this).attr("multiple")=="multiple"){var id=$(this).attr("id"),title=$(this).data("title"),obj={placeholder:title,minimumCountSelected:0,countSelected:title,selectAllText:$(this).data("select-all-text"),allSelected:title,maxHeight:240,onClose:function(){var currentValues=this.target.multipleSelect("getSelects");if($(this.previousValues).not(currentValues).length!==0||$(currentValues).not(this.previousValues).length!==0){ribbonListener.rebuildRibbonState(".sq-top-ribbon")}},onOpen:function(elem){this.target=$(elem).parent().prev();this.previousValues=this.target.multipleSelect("getSelects");var nextElem=$(elem).next(),ul=nextElem.find("ul");if(!nextElem.find(".btn").length){nextElem.append('<div class="mt-10 mb-10 text-right"><button class="btn btn-default mr-10">Reset</button><button class="btn btn-primary mr-10">Apply</button></div>');nextElem.on("click",".btn-default",function(){$(elem).parents(".ms-parent").prev().multipleSelect("uncheckAll")});nextElem.on("click",".btn-primary",function(){$(this).parents(".ms-parent").prev().multipleSelect("close")})}ribbonItem.off("click");if(ul.outerHeight()<ul.prop("scrollHeight")&&!ul.data("width-fixed")){ul.css("width",ul.outerWidth()+$.position.scrollbarWidth());ul.data("width-fixed",true)}nextElem.css("right","auto");if(nextElem.offset().left+nextElem.find("ul").outerWidth(true)>$("body").width()){nextElem.css("right",0)}else{nextElem.css("right","auto")}nextElem.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"});if($(".table-responsive").length>0){if($(elem).parents(".table-responsive").offset().top+$(elem).parents(".table-responsive").outerHeight(true)<nextElem.offset().top+nextElem.find("ul").outerHeight(true)){nextElem.css({top:" -90px","box-shadow":"0 -4px 5px rgba(0,0,0,0.15)"})}else{nextElem.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"})}}else{nextElem.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"})}var selectTagElem=$(elem).parent().prev().get(0);ribbonElem.find("select").each(function(){if(selectTagElem!=this&&$(this).attr("multiple")=="multiple"){var elem=$(this).next();elem.find(".ms-choice").find("> div").removeClass("open").end().next().hide()}})}};if($.inArray(id,["dp-team-dd","dp-mywork-dd"])>-1){obj.width=80}else if(id=="dp-sprint-dd"){$.extend(obj,{width:60,selectAll:false})}else if($.inArray(id,["priority-dd","region-dd","route-to-market-dd"])>-1){obj.width=223}else if($(this).parents("#filters-section").length){obj.width=100}$(this).multipleSelect(obj)}});(function(){var sessionFilterSettings=$.cookie("SQFilterSettings");if(sessionFilterSettings){sessionFilterSettings=$.parseJSON(sessionFilterSettings)}else{sessionFilterSettings={};if(UserPreferences.MyWorkList!=null){sessionFilterSettings.MyWork=UserPreferences.MyWorkList}if(UserPreferences.DepartmentList!=null){sessionFilterSettings.Departments=UserPreferences.DepartmentList}if(UserPreferences.RequestStatusList!=null){$.each(UserPreferences.RequestStatusList,function(indx,val){sessionFilterSettings["RequestStatus"+requestStatuses[val].charAt(0).toUpperCase()+requestStatuses[val].substr(1)]=true})}}initRibbon.findActiveFilters(sessionFilterSettings)})();ribbonElem.addClass("initialized")});function toggleActiveItem(elem){$(elem).toggleClass("active-item-bg").end().removeClass("disable-hover");if($(elem).attr("id")=="sq-filters-item"){moreFiltersElem.removeClass("add-bg")}}function doSearch(){var GridType=$("#GridType").val(),searchFilterElem=$(".search-filter-collector"),searchField=$("#search-query");query=searchField.val().trim();if(query==""){return}searchField.val("");$("#GridRequest").kendoGrid(GridConfiguration($("#GridType").val()+"Search",{searchstring:query}));var ribbonLis=ribbonElem.find("> ul").find("> li");filterStatus(false);$(".filter-collector").hide();searchFilterElem.find("span").text(query).end().show();if(!searchFilterElem.data("initialize")){searchFilterElem.on("click","a",function(e){e.preventDefault();query="";filterStatus(true);$(".filter-collector").show();searchFilterElem.hide();ReloadGrid(0)});searchFilterElem.data("initialize",true)}function filterStatus(enable){ribbonLis.each(function(i){if(i){if(enable){$(this).removeClass("disabled")}else{$(this).addClass("disabled")}}});ribbonElem.find("select").each(function(){if($(this).attr("multiple")=="multiple"){if(enable){$(this).multipleSelect("enable")}else{$(this).multipleSelect("disable")}}})}}