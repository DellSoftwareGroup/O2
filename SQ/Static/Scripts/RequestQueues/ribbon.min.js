var ribbonElem=null;var initRibbon=function(){function i(l){return l.replace(/([A-Z])/g," $1").replace(/^./,function(m){return m.toUpperCase()})}function a(m){var l={};var n=m.split(" ");l.option=n.pop();l.title=n.join(" ");return l}function b(l){var m=$(l).data("title");m=$.trim(m);return c[m]}function g(l){return l.find("option").length}var e={},h=[],c={},d={};function j(l){if(!$.isEmptyObject(l)){e=$.parseJSON(l);this.init()}else{console.warn("No ribbon cookie information found!")}}function f(){function l(){var s=[];$.each(e,function(y,w){var v=$.trim(i(y));if(v.indexOf("Request Status")>-1){var u=a(v);v=u.title;if(v in c){var t=c[v]["option"];t.push(u.option);w=t}else{t=[];t.push(u.option);w=t;v=u.title}}if(s.length==0){s.push(v)}else{var x=false;s.forEach(function(z){if(z==v){x=true}});!x&&s.push(v)}c[v]={option:w,original:y}});return s}var m=function(){var s=l();var t=w();var x=v();h=u();function w(){var y=ribbonElem.find("[data-isFilter=true]"),z=[];y.each(function(){if($(this).data("title")!==undefined){var C=$(this).data("title");z.push(C)}});var A=y.find("[data-title]");A.each(function(){var C=$(this).data("title");if(typeof C!="undefined"){z.push(C)}});var B=y.parents("[data-title]");B.each(function(){var C=$(this).data("title");if(typeof C!="undefined"){z.push(C)}});return z}function v(){var y=[];t.forEach(function(z){s.forEach(function(A){(A.indexOf(z)>-1)?y.push(z):"not a match"})});return y}function u(){var y=[];x.forEach(function(A){var z=$('.sq-top-ribbon [data-title = "'+A+'"]');y.push(z)});return y}return{}}();function r(){h.forEach(function(t){var s=$(t),u={};if(s.attr("multiple")){u=b(t);p($(t),u.option)}else{if(s.data("title")=="Request Status"){u=b(t);o($(t),u.option)}else{if(s.parent("a").attr("data-dynamic")==="true"){u=b(t);n($(t),u.option)}}}})}function p(v,w){var u=$(v).find("option");var s=[],t=[];$(u).each(function(){var x=$(this).val();s.push(x)});s.forEach(function(y,x){if($.isArray(w)){w.filter(function(z){if(z==y){t.push(x)}})}else{if(w==y){t.push(x)}}});$(v).data("trigger","dynamic");t.forEach(function(y,x){y=y+1;q(v,y)})}function o(t,s){$(t).find("li").each(function(){var u=$(this);u.removeClass("active-item-bg");s.forEach(function(v){if(!!u.find('a[title="'+v+'"]').length){u.addClass("active-item-bg")}})})}function n(v,u){var w=$(v).closest("li");var t=w.find("select");u.forEach(function(x){t.append('<option value="'+x.value+'" data-name="'+x.name+'">'+x.name+"</option>")});var s=w.find("span[data-title]").data("title");s=s+" ("+g(t)+")";w.find("span[data-title]").text(s)}function q(u,t){var w=u.closest("li");var v=u.next().find(".ms-drop li");var s=v.eq(t);s.addClass("selected");s.find("input").prop("checked",true);if(s.parents(".sub-nav").length==0){w.addClass("active-item-bg")}}return{typeOfFilter:r}}function k(){d=f();d.typeOfFilter()}return{init:k,findActiveFilters:j}}();var ribbonListener=function(){var b={},c=false;function e(t){var s=$(t).find("[data-isFilter=true]");b={};c=false;return j(s)}function i(t,u){var s=false,v=t.closest("li");if(t.data("title")!==null||t.data("title")!==undefined){b[t.data("title")]=[]}else{console.error("Undefined filter title")}t.next().find(".ms-drop li").each(function(){var x=$(this),w={};w.isSelected=function(){if(x.hasClass("selected")){if(x.parents(".sub-nav").length==0){v.addClass("active-item-bg")}s=true;return true}else{return false}}();w.value=x.find("input").attr("value");w.text=x.find("label").text();w.type=u;b[t.data("title")].push(w)});if(!s){v.removeClass("active-item-bg")}}function d(t,s){if(t.data("title")!==null||t.data("title")!==undefined){b[t.data("title")]=[]}else{alert("No Title issue: see ribbon.js")}t.find("option").each(function(){var v=$(this);var u={};u.text=v.text();u.value=v.attr("value");u.type=s;u.isSelected=function(){if(v.attr("selected")){return true}else{return false}}();b[t.data("title")].push(u)})}function q(s,v){var u=$(s);var t={};b[u.data("title")]=[];t.value=u.find("div:first-child").attr("filterid");t.text=u.find("div:first-child").text();t.isSelected=(typeof t.value!="undefined"&&t.value!="");t.type=v;b[u.data("title")].push(t)}function n(w,v){var u=w.parents("li"),x=u.data("title");if(x!==null||x!==undefined){if(x in b){}else{b[x]=[]}}else{console.error("undefined title!!!")}var t={};t.text=w.find("a span:last-child").text();t.value="no value assigned";t.type=v;t.isSelected=w.hasClass("active-item-bg")?true:false;if(b[x].length>0){var s=b[x].filter(function(y){if(y.text===t.text){return false}else{return true}});s.push(t);b[x]=s}else{b[x].push(t)}}function g(u,v){var t=$(u).find("[data-title]").data("title"),s=$(u).siblings(".dynamic-select");if(t!==null||t!==undefined){b[t]=[]}if(s.length>0){s.find("option").each(function(){var x=$(this);var w={};w.text=x.text();w.value=x.attr("value");w.name=x.data("name");w.type=v;w.isSelected=true;b[t].push(w)})}}function r(){var t=$("#views").find(".ms-drop").find("input"),s={active:""};function x(){$("#views").on("change.views",t,function(z){z.preventDefault();var y=$(z.target);if(y.is("select")){s.clicked=u(y);if(s.clicked===s.active){if($(y).multipleSelect("getSelects")==0){w(u(y))}else{return}}else{if($(y).multipleSelect("getSelects")==0){return}v(u(y))}}})}function w(A){var y=(A=="My Work")?"All Teams":"My Work";var z=$("#views").find('select[data-title="'+y+'"]');z.data("trigger","dynamic");s.active=y;$("#views").off(".views");z.multipleSelect("checkAll");z.parent("li").addClass("active-item-bg");x()}function v(A){if(A==undefined){return}else{var y=(A=="My Work")?"All Teams":"My Work";var z=$("#views").find('select[data-title="'+y+'"]');z.data("trigger","dynamic");s.active=A;$("#views").off(".views");z.multipleSelect("setSelects",[]);z.parent("li").removeClass("active-item-bg");x()}}function u(y){var z=$(y).data("title");$(y).parent("li").addClass("active-item-bg");return z}x()}function l(u){var t=$("#filters-section").find('select[multiple="multiple"]'),s=false;t.each(function(){var v=$(this).data("title");if(u===v){s=true}});return s}function o(s){!!l(s)&&e(".sq-top-ribbon")}var k={};function f(s){k=(function(){var u=s;function t(){if(typeof u!=="undefined"||typeof u!=="function"){u(a(b))}}return{passedFund:u,run:t}}())}function a(z){var y={},w=(z==undefined)?b:z;String.prototype.capitalize=function(){if(this.length>0){return this.charAt(0).toUpperCase()+this.slice(1)}};function A(){this.addProperty=function(C,B){y[C]=B};this.fixedPropertyName=function(E,C){var B="";if(typeof C!=="undefined"){E=E+" "+C}if(E.indexOf(" ")>0){var D=E.split(" ");D.forEach(function(F){if(typeof F=="string"){B=B+F.capitalize()}})}else{if(typeof E=="string"){B=E.capitalize()}}return B}}function v(E){var C=[],D=[],B=[];$.each(E,function(F,G){if(Array.isArray(G)&&G.length>-1){G.forEach(function(H){if(H.isSelected===true){if(H.type=="array-list"){C.push(H.value)}else{if(H.type=="boolean"){D.push(H.text)}else{if(H.type==="userType"){optObj={value:H.value,name:H.name};B.push(optObj)}}}}});if(C.length>0){s(F,C);C=[];return true}else{if(D.length>0){x(F,D);D=[];return true}else{if(B.length>0){t(F,B);B=[];return true}}}}})}function s(D,B){var C=new A();C.addProperty(C.fixedPropertyName(D),B)}function x(D,B){var C=new A();B.forEach(function(E){C.addProperty(C.fixedPropertyName(D,E),true)})}function t(D,B){var C=new A();C.addProperty(C.fixedPropertyName(D),B)}if($.isEmptyObject(w)){console.error("empty object -- see func isdynamicFilter");return false}else{v(w);var u=JSON.stringify(y);return u}}function j(s){s.each(function(){if($(this).attr("multiple")){i($(this),"array-list")}else{if($(this).attr("data-select")==="default"){d($(this),"array-list")}else{if($(this).attr("data-dynamic")==="true"){g($(this),"userType")}else{if($(this).attr("filter-type")==="from-modal"){q($(this),"array-list")}else{if($(this).find("select").length==0){n($(this),"boolean")}}}}}});ribbonWidgets.filterCollectorModule();k.run();return b}function h(v){var u=false,t="",s=0;ribbonElem.on("change","select",function(y){y.preventDefault();var x=$(y.target);var w=x.data("trigger");if(l(x.data("title"))){if(w!=="dynamic"){return}else{if(s>0){s=0;return}x.data("trigger","");s++}}if(u){clearTimeout(t)}t=setTimeout(function(){e(v);u=true},500)});$("#agile-status").on("click","a",function(w){w.preventDefault();if(!$("#agile-status").hasClass("disabled")){toggleActiveItem($(this).parent("li"));e(v)}});$("#dp-sprint-dd").find("option:first-child").text("All Sprints")}function m(){return b}function p(s){var t=ribbonElem.find("[data-isFilter=true]");f(s);j(t);h(ribbonElem);r()}return{isDoneLoading:c,init:p,rebuildRibbonState:e,onCloseMultiFilter:o,passFilterStateObj:m,isFilterSecMultSelect:l,getISobj:a}}();var ribbonWidgets=function(){function a(){var g=ribbonListener.passFilterStateObj();var d=$(".filter-collector");d.html("");function f(){var h={};$.each(g,function(j,i){if(Array.isArray(i)){i.forEach(function(k){if(k.isSelected==true){if(j in h){h[j].push(k)}else{h[j]=[];h[j].push(k)}}})}});return h}function e(k){d.append("<ul><li>Filters:</li></ul>");var h="",i=[];$.each(k,function(m,l){h=String()+"<ul><li>"+m+'<a href="#"> X</a></li>';if(Array.isArray(l)){l.forEach(function(n){h=h+"<li><span>"+n.text+"</span></li>"})}h=h+"</ul>";i.push(h)});var j=i.join(" ");d.append(j)}function c(){function q(v,u){var t=[];if(u===undefined){$(v).data("trigger","dynamic");$(v).multipleSelect("setSelects",[])}else{var s=$(v).multipleSelect("getSelects"),w=$(v).multipleSelect("getSelects","text");w.forEach(function(y,x){if(u==y){t=s.splice(x,1)}});$(v).data("trigger","dynamic");$(v).multipleSelect("setSelects",s)}}function j(s){$("#dp-sprint-dd").val("");ribbonListener.rebuildRibbonState(ribbonElem)}function o(u,t){var s=$(u).parent("a");if(t===undefined){s.siblings("select").html("");ribbonListener.rebuildRibbonState(ribbonElem);$(u).text($(u).data("title"))}else{s.siblings("select option").each(function(){if($(this).text()==t){$(this).remove();ribbonListener.rebuildRibbonState(ribbonElem);p(u)}})}}function m(s){var t=$(s);t.find("div:first-child").attr("filterid","");t.find("div:first-child").html("<span>"+t.data("title")+"</span>");ribbonListener.rebuildRibbonState(ribbonElem)}function r(t,s){if(s==undefined){$(t).find("li").each(function(){$(this).hasClass("active-item-bg")?$(this).removeClass("active-item-bg"):false});ribbonListener.rebuildRibbonState(ribbonElem)}else{$(t).find("li").each(function(){if($(this).find("a span:last-child").text()==s){$(this).removeClass("active-item-bg");ribbonListener.rebuildRibbonState(ribbonElem)}})}}function l(t){var v=$(t).closest("ul"),s=v.find("li").eq(0).text(),u=h(s);return u}function n(s){return $(s).siblings("span").text()}function h(s){var t=s.split(" ");t.pop();s=t.join(" ");return s}function k(s){var t=s.split(" ");t.pop();s=t.toString();return s}function p(t){var s=t.text(),u=$(t).siblings("select").find("option").length;if(s.indexOf("(")>-1){s=k(s);if(u!==0){s=s+" ("+u+")";$(t).text(s)}else{$(t).text(s)}}else{s=s+" ("+u+")";$(t).text(s)}}function i(t,s){if($(t).attr("multiple")){q($(t),s)}else{if($(t).attr("data-select")==="default"){j($(t))}else{if($(t).parent("a").attr("data-dynamic")==="true"){o($(t),s)}else{if($(t).attr("filter-type")==="from-modal"){m($(t))}else{if($(t).find("select").length==0){r($(t),s)}}}}}}$(".filter-collector").off("click","a").on("click","a",function(u){u.preventDefault();var s=l($(this));var t=ribbonElem.find('[data-title="'+s+'"]');if($(this).siblings("span").length>0){var v=n($(this));i(t,v)}else{i(t)}})}e(f());c()}var b=function(){function c(f){var e=function(){$("#filter-"+f).find("#"+f+"-btn").addClass("hidden").end().find("> span").removeClass("hidden")},g=function(){ribbonListener.rebuildRibbonState(".sq-top-ribbon")};$.when(e()).done(g())}function d(){$(".sub-nav").on("click",".clear-btn",function(){var e=$(this).parent("div");$(this).siblings("div").attr("filterid","").html("<span>"+e.data("title")+"</span>").end().addClass("hidden").siblings("input[type=button]").removeClass("hidden");ribbonListener.rebuildRibbonState(".sq-top-ribbon")})}return{init:d,onModalInputchange:c}}();return{filterCollectorModule:a,moreFiltersPopover:b}}();$(function(){ribbonElem=$(".sq-top-ribbon");var a=ribbonElem.find("> ul > li > ul > li"),b=$("#sq-filters .sub-nav-wrapper"),c=b.find(".sub-nav");$("body").on("click",function(d){$("#sq-filters").removeClass("add-bg");$(".sub-nav").hide();if($(d.target).parent().find(".toggle-popover").length>0){$(".toggle-popover").popover("hide")}});$("#sq-filters").on("click",".ms-drop input, .ms-drop label",function(d){d.stopPropagation()}).on("click",function(d){d.stopPropagation();d.preventDefault();if(!$(this).parents(".disabled").length){if($(d.target).parents(".sub-nav-wrapper").length){return false}c.toggle();$(this).toggleClass("add-bg");$(this).find(".sub-nav-wrapper").css("marginLeft","");if($("#sq-filters-item").hasClass("active-item-bg")){$(this).removeClass("add-bg").find(".sub-nav-wrapper").css("marginLeft","-6px")}if(c.is(":visible")){b.css("height","445px")}else{b.css("height","0")}}});(a.children(),c,$(".sub-nav .ms-parent").children(),$(".sq-top-ribbon select")).on("click",function(d){d.stopPropagation()});ribbonElem.find("select").each(function(){if($(this).attr("multiple")=="multiple"){var f=$(this).attr("id"),e=$(this).data("title"),d={placeholder:e,minimumCountSelected:0,countSelected:e,selectAllText:$(this).data("select-all-text"),allSelected:e,maxHeight:240,onClose:function(){var g=this.title,h=this.target.multipleSelect("getSelects");if($(this.previousValues).not(h).length!==0||$(h).not(this.previousValues).length!==0){ribbonListener.onCloseMultiFilter(g)}},onOpen:function(j){this.target=$(j).parent().prev();this.previousValues=this.target.multipleSelect("getSelects");var g=$(j).next(),h=g.find("ul");if(!g.find(".btn").length){g.append('<div class="mt-10 mb-10 text-right"><button class="btn btn-default mr-10">Reset</button><button class="btn btn-primary mr-10">Apply</button></div>');g.on("click",".btn-default",function(){$(j).parent().prev().multipleSelect("uncheckAll")});g.on("click",".btn-primary",function(){$("body").trigger("click")})}a.off("click");if(h.outerHeight()<h.prop("scrollHeight")&&!h.data("width-fixed")){h.css("width",h.outerWidth()+$.position.scrollbarWidth());h.data("width-fixed",true)}g.css("right","auto");if(g.offset().left+g.find("ul").outerWidth(true)>$("body").width()){g.css("right",0)}else{g.css("right","auto")}g.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"});if($(".table-responsive").length>0){if($(j).parents(".table-responsive").offset().top+$(j).parents(".table-responsive").outerHeight(true)<g.offset().top+g.find("ul").outerHeight(true)){g.css({top:" -90px","box-shadow":"0 -4px 5px rgba(0,0,0,0.15)"})}else{g.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"})}}else{g.css({top:" 100%","box-shadow":"0 4px 5px rgba(0,0,0,0.15)"})}var i=$(j).parent().prev().get(0);ribbon.find("select").each(function(){if(i!=this&&$(this).attr("multiple")=="multiple"){var k=$(this).next();k.find(".ms-choice").find("> div").removeClass("open").end().next().hide()}})}};if($.inArray(f,["dp-team-dd","dp-mywork-dd"])>-1){d.width=80}else{if(f=="dp-sprint-dd"){$.extend(d,{width:60,selectAll:false})}else{if($.inArray(f,["priority-dd","region-dd","route-to-market-dd"])>-1){d.width=223}else{if($(this).parents("#filters-section").length){d.width=100}}}}$(this).multipleSelect(d)}});initRibbon.findActiveFilters(GetLastFilterSettings());ribbonElem.addClass("initialized")});function toggleActiveItem(a){$(a).toggleClass("active-item-bg").end().removeClass("disable-hover");if($(a).attr("id")=="sq-filters-item"){$(a).find("#sq-filters").removeClass("add-bg")}}function doSearch(){var b=$("#GridType").val(),e=$(".search-filter-collector"),d=$("#search-query");query=d.val().trim();if(query==""){return}d.val("");$("#GridRequest").kendoGrid(GridConfiguration($("#GridType").val()+"Search",{searchstring:query}));var a=ribbonElem.find("> ul").find("> li");c(false);$(".filter-collector").hide();e.find("span").text(query).end().show();if(!e.data("initialize")){e.on("click","a",function(f){f.preventDefault();query="";c(true);$(".filter-collector").show();e.hide();ReloadGrid(0)});e.data("initialize",true)}function c(f){a.each(function(g){if(g){if(f){$(this).removeClass("disabled")}else{$(this).addClass("disabled")}}});ribbonElem.find("select").each(function(){if($(this).attr("multiple")=="multiple"){if(f){$(this).multipleSelect("enable")}else{$(this).multipleSelect("disable")}}})}};